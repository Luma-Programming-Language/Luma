@module "main"

@use "string" as string
@use "io" as io
@use "types" as types


pub const main -> fn () int {

    // make the project folder
    let project_name: *byte = "mkdir -p project";
    system(make_root_command)
    io::print_str("Created %s root\n", [project_name]);


    system("touch project/build.bolt");

    let build_info_dump: *byte = cast<*byte>(alloc(sizeof<*byte> * 1024));
    defer { free(build_info_dump); }

    let slices: *Slice = cast<*Slice>(alloc(5 * sizeof<Slice>));
    defer { free(slices); }

    let abc: *byte = "abc";
    let de: *byte = "de";
    let jk:*byte = "jk";

    slices[0] = slices.null_terminated_slice(abc);
    slices[1] = slices.null_terminated_slice(de);
    slices[2] = slices.null_terminated_slice("fghi");
    slices[3] = slices.null_terminated_slice(jk);
    slices[4] = types::NULL_BYTE;

    let front: String;
    front = front.concat_strs(slices, 4);
    defer { string::free_string(&front); }

    front.slice.len = front.slice.len - 1;

    let more: *Slice = cast<*Slice>(alloc(3 * sizeof<Slice>));
    defer { free(more); }

    more[0] = front.as_slice();
    more[1] = more.null_terminated_slice("lmnop");
    more[2] = types::NULL_BYTE;
    
    let final: String;
    final = final.concat_strs(more, 3);
    defer { string::free_string(&final); }

    io::write_buffer_to_file("project/build.bolt", final.slice.ptr);

    return 0;
}
